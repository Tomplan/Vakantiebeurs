<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>4x4 Vakantiebeurs Map (Leaflet + SVG)</title>
  <!-- 
    ============================================
    META: RESPONSIVENESS & VIEWPORT SETTINGS
    ============================================
    The viewport meta tag ensures the map displays properly
    across different screen sizes. 
    - "maximum-scale=1.0" prevents users from zooming in manually on mobile.
    - "user-scalable=no" disables pinch zoom.
  -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" ">
  
  <!-- ============================================
       LEAFLET CORE STYLESHEET (required)
       ============================================ -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-search@2.9.9/dist/leaflet-search.min.css"/>
  
  <style>
    
  /* 
  ============================================
  BASIC PAGE & MAP STYLING
  ============================================ 
  */
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f6f6f6;
    }
    
    /* The map container should fill the entire viewport */
    #map {
      width: 100vw;
      height: 100%;
      z-index: 1;
    }
    /* 
    ============================================
    TITLE OVERLAY (Centered Title Text)
    ============================================
    - Positioned absolutely in the center-top area
    - Non-interactive (pointer-events: none)
    */

    .title-overlay {
      position: absolute;
      top: 5%;
      left: 50%;
      transform: translate(-50%, 0);
      color: #1976d2;
      background: rgba(255,255,255,0.85);
      padding: 0.4em 1.2em;
      border-radius: 16px;
      font-size: 1.2em;
      font-weight: bold;
      box-shadow: 0 2px 18px rgba(0,0,0,0.11);
      z-index: 400;
      pointer-events: none;
      text-align: center;
      white-space: nowrap;
      max-width: 90vw;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Responsive font scaling for mobile */
    @media (max-width: 600px) {
      .title-overlay {
        font-size: 1em;
        padding: 0.3em 0.7em;
      }
    }
    /* 
    ============================================
    DEVICE ORIENTATION MESSAGE (Portrait Warning)
    ============================================
    - Blurs the map when the device is held vertically.
    - Displays a message asking to rotate the device.
    */

    
    @media only screen and (orientation: portrait) {
      #map {
        filter: blur(5px);
      }
      .title-overlay {
        filter: blur(5px);
      }
      body::before {
        content: "Please rotate your device to landscape!";
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100vh;
        background: rgba(255,255,255,0.96);
        color: #1976d2;
        display: flex; align-items: center; justify-content: center;
        font-size: 1em;
        z-index: 9999;
        text-align: center;
        padding: 1em;
        pointer-events: auto;
        filter: none;
      }
    }
    @media only screen and (orientation: portrait) and (max-width: 600px) {
      body::before {
        font-size: 0.85em;
        padding: 0.5em;
      }
    }
        
    /* 
    ============================================
    LABEL STYLE FOR STAND NUMBERS
    ============================================
    - Always visible tooltips attached to markers
    - Styled as simple white text boxes
    */
 
    /* Tooltip Stand label styles */
    /* 
    background: #1976d2;
    box-shadow: 0 2px 8px rgba(0,0,0,0.13);
    border: 2px solid #fff;
    
      border-radius: 100%;
    */
    .stand-label {
      width: 1.1em;
      color: #000000;
      font-weight: bold;
      font-size: 0.9em;
      padding: 0em 0em;
      text-align: center;
      background: #ffffff;
      box-shadow: 0 0px 0px rgba(0,0,0,0);
      border: 0px solid #fff;
    }
   
  </style>
</head>
<body>
  <!-- 
  ================================
  MAIN MAP CONTAINER
  ================================ -->

  <div id="map"></div>
  <div class="title-overlay">4x4 Vakantiebeurs</div>
  
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-search@2.9.9/dist/leaflet-search.min.js"></script>
  
  <script>
        // ============================================================
    // Since we’re overlaying an SVG image (not a real map),
    // we use Leaflet’s “CRS.Simple” coordinate system.
    // This allows using simple x/y coordinates instead of lat/lng.
    // ------------------------------------------------------------

    // These are the "dimensions" of your SVG map (the viewBox size).
    // They define the coordinate system used by Leaflet in "CRS.Simple" mode.
    // === Configure SVG map bounds ===
    // These bounds should match your SVG's coordinate system.
    // For example, if your SVG's viewBox is "0 0 700 500":
    
   // const svgWidth = 4000;
  //  const svgHeight = 2000;
    
   // The image bounds tell Leaflet how large and where to draw your SVG.
    // Format: [[southWestLat, southWestLng], [northEastLat, northEastLng]]
    // Because we’re in flat mode, these are just y/x pairs.
    // The SVG will be placed as an "image overlay" with the following corners:
    // Leaflet expects bounds in the form [[southWestY, southWestX], [northEastY, northEastX]]
    // Leaflet image overlay bounds: [[southWestLat, southWestLng], [northEastLat, northEastLng]]
    // We'll set the image overlay so that [0,0] is bottom left, [700,500] is top right.
    // We'll use a simple "pseudo-coordinates" system for the SVG: y increases upward, x to right.
    // Note: These are not real lat/lng. They are just for overlaying your SVG and markers.
    // SouthWest corner (bottom left): [0, 0]
    // NorthEast corner (top right): [svgHeight, svgWidth] (Leaflet uses [lat, lng] i.e. [y, x])

   //  const imageBounds = [[0, 0], [svgHeight, svgWidth]];


    // ============================================================
    // 2. INITIALIZE THE MAP
    // ============================================================

    // Create the Leaflet map in "Simple CRS" mode
    // This mode uses a flat coordinate plane instead of latitude/longitude.
    // Create the Leaflet map using the SVG coordinate system
var map = L.map('map').setView([51.89808547622925, 5.773899908908296], 29);

var streetMap = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
});
  
  streetMap.addTo(map);

var terrainMap2 = L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_terrain_background/{z}/{x}/{y}{r}.{ext}', {
	minZoom: 0,
	maxZoom: 18,
	attribution: '&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	ext: 'png'
});

 //  terrainMap.addTo(map);
    var terrainMap = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', {
	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
	subdomains: 'abcd',
	maxZoom: 35
});
	   terrainMap.addTo(map);

const imageBounds = [[51.8943217320389, 5.76744803036467], [51.902513722275536, 5.788097624995013]];
	  // 51.895609875105364, 5.766788634686883 left corner bottom
	  // 51.90076398574364, 5.788840459930832 right corner top
	  
 //   const map = L.map('map', {
      //crs: L.CRS.Simple,
 //     minZoom: -1,
 //     maxZoom: 2,
 //     zoom: -1,
 //     center: [svgHeight/2, svgWidth/2], // center of the SVG
 //     zoomControl: true,
      //setView([0,0],1),
      //fitbounds([[0, 0], [4000, 2000]])
 //   }).setView([900,1200],0.2);

    // Overlay the SVG as the background image for the map
    // This acts like a tile layer, but with your own map artwork.
    // Add the SVG map as image overlay

    const svgOverlay = L.imageOverlay('src/map.svg', imageBounds).addTo(map);
    
    // ============================================================
    // 3. LOAD STANDHOLDER DATA FROM JSON
    // ============================================================
    // The JSON file includes all exhibitors/stands, like:
    // [
    //   { "name": "Stand A", "x": 1000, "y": 800, "stand": "12A",
    //     "description": "Example company", "img": "img/a.jpg" }
    // ]
    // The “?v=Date.now()” ensures browsers don’t cache old data.
    // ============================================================

    // ======= Load standholders.json and add circles =======
    // Each standholder should have x/y matching the SVG's viewBox
    
    fetch('src/data/standholders.json?v=' + Date.now())
      .then(response => response.json())
      .then(standholders => {
        // ============================================================
        // 4. CREATE MARKERS FROM JSON DATA
        // ============================================================
        
        // This LayerGroup will hold all stand markers

        const markerLayer = L.layerGroup().addTo(map);
        
        // Function to show/hide markers based on zoom level
        function showMarkersIfZoom() {
          
          // Remove old markers before redrawing (prevents duplicates)
          markerLayer.clearLayers();
          
         // Example condition: Only show markers at or above a certain zoom
          // (here always true, but you can adjust for performance)
          // Show circles only if zoom >= 1 (adjust as needed)
          
          if (map.getZoom() >= -1) {
            
            // Loop through every stand object in the JSON
            
            standholders.forEach(stand => {
              
              // Leaflet uses [lat, lng], so in our flat system: [y, x]
              // Convert SVG x/y to Leaflet pseudo-lat/lng

              const marker = L.marker([stand.y, stand.x], {
                title: stand.name,
                riseOnHover: true,
                draggable: true
              });
              /* 
                radius: 10,
                color: "#1976d2",
                fillColor: "#1976d2",
                fillOpacity: 0.8,
                weight: 2
              */
              
              // Bind a popup that appears when the marker is clicked
              marker.bindPopup(`
                <img src=${stand.img} style="width:100px">
                <h2 style="margin:0;font-size:1.1em">${stand.name}</h2>
                <p><b>Stand:</b> ${stand.stand}</p>
                <p style="margin:0 0 0.5em 0">${stand.description}</p>
                ${stand.website ? `<a href="${stand.website}" target="_blank" style="color:#1976d2;text-decoration:underline;font-weight:bold;">Visit website</a>` : ''}
              `);

              // Bind a permanent label showing the stand number
              
              marker.bindTooltip(stand.stand, {
                permanent: true,           // Always visible
                direction: 'center',       // Centered on the marker
                className: 'stand-label',  // CSS class for styling
                offset: [-15.5,-0.5],      // offset
                opacity: 1                 // Fully visible
              });
              // Add this marker to the group
              markerLayer.addLayer(marker);
            });   // ends forEach
          }       // ends if
        }         // ends function showMarkersIfZoom

        // Run once at startup
        // Show/hide circles at startup and on zoom

        showMarkersIfZoom();
        
        // Update marker visibility whenever zoom changes
        map.on('zoomend', showMarkersIfZoom);
                
        // ============================================================
        // 5. ADD SEARCH CONTROL
        // ============================================================
        // The Leaflet Search plugin allows you to search
        // through a layer by a specific property (here: "title").
        // It automatically lists options as you type.
        // ============================================================
        
      var searchControl = new L.Control.Search({
      layer: markerLayer,           // The layer to search within
      propertyName: 'title',        // Search field (uses marker.options.title)
      initial: false,               // Don't prefill results on startup
      marker: false,                // Don't create a new marker when searching
      moveToLocation: function(latlng, title, map) {
        // Define what happens when an item is found
        // Here: zoom in and center on the found marker
            map.setView(latlng, 2);
        }
      });
        
      // Add the search control to the map UI (defaults to top right)
      map.addControl(searchControl);


     // Open Markers Popup when searched for and found

      searchControl.on('search:locationfound', function(e) {
     e.layer.fire('click'); // Automatically open popup
      //  e.openPopup()
      });

      });

    
  </script>
</body>
</html>
