<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>4x4 Vakantiebeurs Map (Leaflet + SVG)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f6f6f6;
    }
    #map {
      width: 100vw;
      height: 100vh;
      z-index: 1;
    }
    .title-overlay {
      position: absolute;
      top: 5%;
      left: 50%;
      transform: translate(-50%, 0);
      color: #1976d2;
      background: rgba(255,255,255,0.85);
      padding: 0.4em 1.2em;
      border-radius: 16px;
      font-size: 1.2em;
      font-weight: bold;
      box-shadow: 0 2px 18px rgba(0,0,0,0.11);
      z-index: 400;
      pointer-events: none;
      text-align: center;
      white-space: nowrap;
      max-width: 90vw;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    @media (max-width: 600px) {
      .title-overlay {
        font-size: 1em;
        padding: 0.3em 0.7em;
      }
    }
    @media only screen and (orientation: portrait) {
      #map {
        filter: blur(5px);
      }
      .title-overlay {
        filter: blur(5px);
      }
      body::before {
        content: "Please rotate your device to landscape for the best experience!";
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100vh;
        background: rgba(255,255,255,0.96);
        color: #1976d2;
        display: flex; align-items: center; justify-content: center;
        font-size: 1em;
        z-index: 9999;
        text-align: center;
        padding: 1em;
        pointer-events: auto;
        filter: none;
      }
    }
    @media only screen and (orientation: portrait) and (max-width: 600px) {
      body::before {
        font-size: 0.85em;
        padding: 0.5em;
      }
    }
    /* Stand label styles */
    .stand-label {
      background: #1976d2;
      color: #fff;
      border-radius: 50%;
      font-weight: bold;
      font-size: 1em;
      padding: 0.6em 0.9em;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.13);
      border: 2px solid #fff;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="title-overlay">4x4 Vakantiebeurs</div>
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // === Configure SVG map bounds ===
    // These bounds should match your SVG's coordinate system.
    // For example, if your SVG's viewBox is "0 0 700 500":
    const svgWidth = 700;
    const svgHeight = 500;
    // Leaflet image overlay bounds: [[southWestLat, southWestLng], [northEastLat, northEastLng]]
    // We'll set the image overlay so that [0,0] is bottom left, [700,500] is top right.
    // We'll use a simple "pseudo-coordinates" system for the SVG: y increases upward, x to right.
    // Note: These are not real lat/lng. They are just for overlaying your SVG and markers.

    // SouthWest corner (bottom left): [0, 0]
    // NorthEast corner (top right): [svgHeight, svgWidth] (Leaflet uses [lat, lng] i.e. [y, x])
    const imageBounds = [[0, 0], [svgHeight, svgWidth]];

    // Create the Leaflet map using the SVG coordinate system
    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -2,
      maxZoom: 2,
      zoom: 0,
      center: [svgHeight/2, svgWidth/2], // center of the SVG
      zoomControl: true
    });

    // Add SVG as image overlay
    const svgOverlay = L.imageOverlay('src/map.svg', imageBounds).addTo(map);

    // ======= Load standholders.json and add circles =======
    // Each standholder should have x/y matching the SVG's viewBox
    fetch('src/data/standholders.json?v=' + Date.now())
      .then(response => response.json())
      .then(standholders => {
        const markerLayer = L.layerGroup().addTo(map);

        function showMarkersIfZoom() {
          markerLayer.clearLayers();
          // Show circles only if zoom >= 1 (adjust as needed)
          if (map.getZoom() >= 4) {
            standholders.forEach(stand => {
              // Convert SVG x/y to Leaflet pseudo-lat/lng
              // Leaflet uses [lat, lng] so [y, x]
              const marker = L.circleMarker([stand.y, stand.x], {
                radius: 20,
                color: "#1976d2",
                fillColor: "#1976d2",
                fillOpacity: 0.8,
                weight: 2
              });
              marker.bindPopup(`
                <h2 style="margin:0;font-size:1.1em">${stand.name}</h2>
                <p><b>Stand:</b> ${stand.stand}</p>
                <p style="margin:0 0 0.5em 0">${stand.description}</p>
                ${stand.website ? `<a href="${stand.website}" target="_blank" style="color:#1976d2;text-decoration:underline;font-weight:bold;">Visit website</a>` : ''}
              `);
              marker.bindTooltip(stand.stand, {permanent: true, direction: 'center', className: 'stand-label', offset: [0,0]});
              markerLayer.addLayer(marker);
            });
          }
        }

        // Show/hide circles at startup and on zoom
        showMarkersIfZoom();
        map.on('zoomend', showMarkersIfZoom);
      });
  </script>
</body>
</html>
